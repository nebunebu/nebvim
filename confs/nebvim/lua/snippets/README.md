# LuaSnip Snippets

This directory contains Lua-based snippets for LuaSnip, integrated with blink.cmp.

## Directory Structure

```
snippets/
├── all.lua                  # Global snippets (all filetypes)
├── lua.lua                  # Lua-specific snippets
├── nix.lua                  # Nix-specific snippets
├── markdown.lua             # Markdown snippets
├── javascript.lua           # JavaScript snippets
├── typescript.lua           # TypeScript snippets (extends JavaScript)
├── javascriptreact.lua      # JSX snippets
├── typescriptreact.lua      # TSX snippets (extends TypeScript + React)
└── README.md                # This file
```

## Usage

### Expanding Snippets

1. **Type the trigger**: Start typing the snippet trigger (e.g., `func`, `todo`, `if`)
1. **Select from completion menu**: The snippet appears in blink.cmp's completion menu
1. **Expand**: Press `<CR>` (Enter) to expand the snippet
1. **Navigate**: Use `<Tab>` and `<S-Tab>` to jump between snippet nodes
1. **Choice nodes**: Use `<C-l>` to cycle through alternatives in choice nodes

### Alternative Navigation (Optional)

Additional keymaps are configured for snippet navigation:

- `<C-k>`: Expand or jump forward
- `<C-j>`: Jump backward
- `<C-l>`: Change choice in choiceNode

### Example Workflow

```lua
-- Type "func" in a Lua file
-- Press <CR> to expand
-- Result:
function name(args)
  -- body
end

-- Press <Tab> to jump to "name" → type function name
-- Press <Tab> to jump to "args" → type arguments
-- Press <Tab> to jump to body → write function code
```

## Creating New Snippets

### File Organization

- **Global snippets**: Add to `all.lua` (available in all filetypes)
- **Filetype-specific**: Create `<filetype>.lua` (e.g., `python.lua`, `rust.lua`)

### Snippet Structure

```lua
-- Basic snippet template
local ls = require("luasnip")
local s = ls.snippet
local t = ls.text_node
local i = ls.insert_node
local fmt = require("luasnip.extras.fmt").fmt

return {
  -- Simple snippet
  s("trigger", {
    t("static text"),
    i(1, "placeholder"),
  }),

  -- Snippet with fmt (easier multiline formatting)
  s("trigger2", fmt([[
    line 1 with {}
    line 2 with {}
  ]], {
    i(1, "first placeholder"),
    i(2, "second placeholder"),
  })),
}
```

### Node Types

#### 1. Text Node (`t`)

Static text that doesn't change.

```lua
t("Hello, World!")
t({ "line 1", "line 2" })  -- Multiline
```

#### 2. Insert Node (`i`)

Jump points where you type content.

```lua
i(1, "placeholder text")  -- First jump point
i(2)                      -- Second jump point (no placeholder)
i(0)                      -- Final jump point (exit snippet)
```

#### 3. Function Node (`f`)

Dynamic content generated by a function.

```lua
f(function(args)
  return os.date("%Y-%m-%d")
end)

-- With arguments from other nodes
f(function(args)
  return args[1][1]:upper()  -- Uppercase of insert node 1
end, { 1 })
```

#### 4. Choice Node (`c`)

Multiple alternatives to choose from.

```lua
c(1, {
  t("option 1"),
  t("option 2"),
  t("option 3"),
})
-- Press <C-l> to cycle through choices
```

#### 5. Repeat Node (`rep`)

Repeats content from another insert node.

```lua
local rep = require("luasnip.extras").rep

s("example", fmt([[
  const {} = {}
  console.log({})
]], {
  i(1, "variable"),
  i(2, "value"),
  rep(1),  -- Repeats content of node 1
}))
```

### Helper Functions

#### fmt - Format String

Easier way to write multiline snippets with `{}` placeholders.

```lua
local fmt = require("luasnip.extras.fmt").fmt

s("func", fmt([[
  function {}({}) {{
    {}
  }}
]], {
  i(1, "name"),
  i(2, "args"),
  i(3, "// body"),
}))
```

#### fmta - Format String (Angle Brackets)

Same as `fmt` but uses `<>` instead of `{}` (useful when snippet contains braces).

```lua
local fmta = require("luasnip.extras.fmt").fmta

s("class", fmta([[
  class <> {
    <>
  }
]], {
  i(1, "ClassName"),
  i(2, "// body"),
}))
```

### Advanced Examples

#### Snippet with Function Node

```lua
-- Filename without extension
s("filename", {
  f(function()
    return vim.fn.expand("%:t:r")
  end),
})
```

#### Snippet with Choice and Repeat

```lua
s("log", fmt([[
  console.{}("{}: ", {})
]], {
  c(1, {
    t("log"),
    t("error"),
    t("warn"),
    t("info"),
  }),
  i(2, "label"),
  rep(2),
}))
```

#### Dynamic Node (Advanced)

```lua
local d = ls.dynamic_node
local sn = ls.snippet_node

s("dynamic", {
  i(1, "type"),
  d(2, function(args)
    if args[1][1] == "function" then
      return sn(nil, { t("() => {}") })
    else
      return sn(nil, { t("value") })
    end
  end, { 1 }),
})
```

## Filetype Mapping

LuaSnip automatically loads snippets based on filetype:

| Filetype | Snippet File |
|----------|-------------|
| All | `all.lua` |
| lua | `lua.lua` |
| nix | `nix.lua` |
| markdown | `markdown.lua` |
| javascript | `javascript.lua` |
| typescript | `typescript.lua` + `javascript.lua` |
| javascriptreact | `javascriptreact.lua` (+ `javascript.lua`) |
| typescriptreact | `typescriptreact.lua` (+ `typescript.lua` + `javascript.lua`) |

## Debugging

### Check if Snippets are Loaded

```vim
:lua print(vim.inspect(require("luasnip").get_snippets()))
```

### Reload Snippets

```vim
:LuaSnipUnlinkCurrent
:lua require("luasnip.loaders.from_lua").lazy_load()
```

### Check Available Snippets for Current Buffer

```vim
:lua print(vim.inspect(require("luasnip").available()))
```

## Resources

- [LuaSnip Documentation](https://github.com/L3MON4D3/LuaSnip/blob/master/DOC.md)
- [LuaSnip Wiki](https://github.com/L3MON4D3/LuaSnip/wiki)
- [Example Snippets](https://github.com/L3MON4D3/LuaSnip/blob/master/Examples/snippets.lua)
- [blink.cmp Integration](https://github.com/Saghen/blink.cmp)

## Tips

1. **Start simple**: Begin with basic `s()`, `t()`, and `i()` nodes
1. **Use fmt**: `fmt()` makes multiline snippets much easier to read
1. **Test incrementally**: Add one snippet at a time and test it
1. **Check filetype**: Use `:set filetype?` to verify the current filetype
1. **Use placeholders**: Good placeholder text helps remember what to type
1. **Document complex snippets**: Add comments explaining dynamic behavior
1. **Organize by category**: Group related snippets together in files
